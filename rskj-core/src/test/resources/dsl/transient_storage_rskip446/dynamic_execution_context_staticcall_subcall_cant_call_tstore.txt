comment

// CONTRACT CODE
pragma solidity ^0.8.24;

contract TstorageExecutionContextsStaticCallCantCallTstore {

    constructor() {
    }

    event OK();
    event ERROR(string, uint256);

    function testCall() external {
        // Deploy the Callee contract
        address calleeAddress = address(new Callee());
        uint256 success;
        uint256 valueLoadedFrom0;
        bytes4 executeSignature = bytes4(keccak256("execute()"));

        assembly {
            tstore(0, 420)
            let availablePointer := mload(0x40)
            mstore(availablePointer, executeSignature)
            success := staticcall(0xFFFF, calleeAddress, availablePointer, 0x4, availablePointer, 0x20)
            valueLoadedFrom0 := tload(0)
        }

        checkReturnValueExpected(success, 'Checking result callee execution fails', 0);
        checkReturnValueExpected(valueLoadedFrom0, 'Checking value from tload 0', 420);
    }

    function checkReturnValueExpected(uint256 valueReceived, string memory message, uint256 expectedValue) private {
        if( valueReceived == expectedValue){
            emit OK();
        } else {
            emit ERROR(message, valueReceived);
        }
    }
}

contract Callee {


    function execute() external {
        assembly {
            tstore(1, 69)
        }
    }
}

// CONTRACT BYTECODE

TstorageExecutionContextsStaticCallCantCallTstore: 608060405234801561000f575f80fd5b506103468061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063d411defb1461002d575b5f80fd5b610035610037565b005b5f60405161004490610185565b604051809103905ff08015801561005d573d5f803e3d5ffd5b5090505f805f7f614619540b5b5abe478b88f28a37eb328054be3b41a7570ad5e8b701113364c490506101a45f5d6040518181526020816004838861fffffa93505f5c9250506100c6836040518060600160405280602681526020016102eb602691395f61010e565b610108826040518060400160405280601b81526020017f436865636b696e672076616c75652066726f6d20746c6f6164203000000000008152506101a461010e565b50505050565b808303610146577fd48fe2800bace8f5ca2450feacbd6efc681b1cd0115019bb49fa529b6171bf6760405160405180910390a1610180565b7fc9e730d5b570f89e168eb8c3d29f8c396b957e540af248c95c9519ac47c2c69f8284604051610177929190610233565b60405180910390a15b505050565b60898061026283390190565b5f81519050919050565b5f82825260208201905092915050565b5f5b838110156101c85780820151818401526020810190506101ad565b5f8484015250505050565b5f601f19601f8301169050919050565b5f6101ed82610191565b6101f7818561019b565b93506102078185602086016101ab565b610210816101d3565b840191505092915050565b5f819050919050565b61022d8161021b565b82525050565b5f6040820190508181035f83015261024b81856101e3565b905061025a6020830184610224565b939250505056fe6080604052348015600e575f80fd5b50606f80601a5f395ff3fe6080604052348015600e575f80fd5b50600436106026575f3560e01c80636146195414602a575b5f80fd5b60306032565b005b604560015d56fea2646970667358221220a5f01eceb4465312039e37fe5b8913c77743ea042f64eb0e55a16f3e422abde864736f6c63430008180033436865636b696e6720726573756c742063616c6c656520657865637574696f6e206661696c73a2646970667358221220c2660b49032f7ee7ddf39afb75369768bfdc123aa7021d49df042a9ba368053164736f6c63430008180033

d411defb: testStaticCall()

end

# Create and fund new account
account_new acc1 10000000

# Create transaction to deploy TstorageExecutionContextsStaticCallCantCallTstore contract
transaction_build txContextStaticCallCantCallTstoreContract
    sender acc1
    receiverAddress 00
    value 0
    data 608060405234801561000f575f80fd5b506103468061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063d411defb1461002d575b5f80fd5b610035610037565b005b5f60405161004490610185565b604051809103905ff08015801561005d573d5f803e3d5ffd5b5090505f805f7f614619540b5b5abe478b88f28a37eb328054be3b41a7570ad5e8b701113364c490506101a45f5d6040518181526020816004838861fffffa93505f5c9250506100c6836040518060600160405280602681526020016102eb602691395f61010e565b610108826040518060400160405280601b81526020017f436865636b696e672076616c75652066726f6d20746c6f6164203000000000008152506101a461010e565b50505050565b808303610146577fd48fe2800bace8f5ca2450feacbd6efc681b1cd0115019bb49fa529b6171bf6760405160405180910390a1610180565b7fc9e730d5b570f89e168eb8c3d29f8c396b957e540af248c95c9519ac47c2c69f8284604051610177929190610233565b60405180910390a15b505050565b60898061026283390190565b5f81519050919050565b5f82825260208201905092915050565b5f5b838110156101c85780820151818401526020810190506101ad565b5f8484015250505050565b5f601f19601f8301169050919050565b5f6101ed82610191565b6101f7818561019b565b93506102078185602086016101ab565b610210816101d3565b840191505092915050565b5f819050919050565b61022d8161021b565b82525050565b5f6040820190508181035f83015261024b81856101e3565b905061025a6020830184610224565b939250505056fe6080604052348015600e575f80fd5b50606f80601a5f395ff3fe6080604052348015600e575f80fd5b50600436106026575f3560e01c80636146195414602a575b5f80fd5b60306032565b005b604560015d56fea2646970667358221220a5f01eceb4465312039e37fe5b8913c77743ea042f64eb0e55a16f3e422abde864736f6c63430008180033436865636b696e6720726573756c742063616c6c656520657865637574696f6e206661696c73a2646970667358221220c2660b49032f7ee7ddf39afb75369768bfdc123aa7021d49df042a9ba368053164736f6c63430008180033
    gas 1000000
    build

# Create block to hold txContextStaticCallCantCallTstoreContract transaction
block_build b01
    parent g00
    transactions txContextStaticCallCantCallTstoreContract
    gasLimit 1200000
    build

# Connect block
block_connect b01

# Check b01 is best block
assert_best b01

# Create transaction to execute txExecuteStaticCallCode transaction
transaction_build txExecuteStaticCallCode
    sender acc1
    nonce 1
    contract txContextStaticCallCantCallTstoreContract
    value 0
    data d411defb
    gas 1000000
    build

# Create block to hold txExecuteStaticCallCode transaction
block_build b02
    parent b01
    transactions txExecuteStaticCallCode
    gasLimit 2000000
    build

# Connect block
block_connect b02

# Check b02 is best block
assert_best b02