comment

// CONTRACT CODE
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

contract TloadTstoreCheckingBetweenTransactions {
    constructor() {
    }

    event OK();
    event ERROR(string, uint256);
    event ValueStored(uint256 key, uint256 value);
    event ValueLoaded(uint256 key, uint256 value);

    // Function to test TSTORE some value
    function tstoreAndTloadSomeValue(uint256 key, uint256 value) external {
        uint256 loadedValue;
        assembly {
            // Store a value in transient storage
            tstore(key, value)
        }
        emit ValueStored(key, value);

        assembly {
            // Load the value from transient storage
            loadedValue := tload(key)
        }
        emit ValueLoaded(key, loadedValue);
    }

    // Function to test TSTORE some value
    function tloadSomeValueAndCheckWithExpected(uint256 key, uint256 valueExpected) external {
        uint256 loadedValue;
        assembly {
            // Load the value from transient storage
            loadedValue := tload(key)
        }
        emit ValueLoaded(key, loadedValue);
        if (loadedValue == valueExpected) {
            emit OK();
        } else {
            emit ERROR('Value loaded is different from the expected',loadedValue);
        }
    }
}

// CONTRACT BYTECODE

TloadTstoreCheckingBetweenTransactions: 6080604052348015600e575f5ffd5b5061032f8061001c5f395ff3fe608060405234801561000f575f5ffd5b5060043610610034575f3560e01c806398c051f414610038578063a042e69514610054575b5f5ffd5b610052600480360381019061004d91906101d9565b610070565b005b61006e600480360381019061006991906101d9565b6100ef565b005b5f81835d7f310f8ed862379d5c76886cc6d311ff93d07260f8609687c75d38a3916f469b5583836040516100a5929190610226565b60405180910390a1825c90507f9852f8e8d49fd9a2e49e060d8d3b08d73a4cad92444150877509d7ab57f2e5ef83826040516100e2929190610226565b60405180910390a1505050565b5f825c90507f9852f8e8d49fd9a2e49e060d8d3b08d73a4cad92444150877509d7ab57f2e5ef8382604051610125929190610226565b60405180910390a1818103610165577fd48fe2800bace8f5ca2450feacbd6efc681b1cd0115019bb49fa529b6171bf6760405160405180910390a161019d565b7fc9e730d5b570f89e168eb8c3d29f8c396b957e540af248c95c9519ac47c2c69f8160405161019491906102cd565b60405180910390a15b505050565b5f5ffd5b5f819050919050565b6101b8816101a6565b81146101c2575f5ffd5b50565b5f813590506101d3816101af565b92915050565b5f5f604083850312156101ef576101ee6101a2565b5b5f6101fc858286016101c5565b925050602061020d858286016101c5565b9150509250929050565b610220816101a6565b82525050565b5f6040820190506102395f830185610217565b6102466020830184610217565b9392505050565b5f82825260208201905092915050565b7f56616c7565206c6f6164656420697320646966666572656e742066726f6d20745f8201527f6865206578706563746564000000000000000000000000000000000000000000602082015250565b5f6102b7602b8361024d565b91506102c28261025d565b604082019050919050565b5f6040820190508181035f8301526102e4816102ab565b90506102f36020830184610217565b9291505056fea2646970667358221220433294a89265547198272c5831a9646c55777d997ff5f31e3d70a38fb431c2ea64736f6c634300081c0033

// CONTRACT CALLS

TloadTstoreCheckingBetweenTransactions:

- a042e695: tloadSomeValueAndCheckWithExpected(uint256,uint256)
- 98c051f4: tstoreAndTloadSomeValue(uint256,uint256)

end

# Create and fund new account
account_new acc1 10000000

# Create transaction to deploy TloadTstoreCheckingBetweenTransactions contract
transaction_build txTloadTstoreCheckingBetweenTransactionsContract
    sender acc1
    receiverAddress 00
    value 0
    data 6080604052348015600e575f5ffd5b5061032f8061001c5f395ff3fe608060405234801561000f575f5ffd5b5060043610610034575f3560e01c806398c051f414610038578063a042e69514610054575b5f5ffd5b610052600480360381019061004d91906101d9565b610070565b005b61006e600480360381019061006991906101d9565b6100ef565b005b5f81835d7f310f8ed862379d5c76886cc6d311ff93d07260f8609687c75d38a3916f469b5583836040516100a5929190610226565b60405180910390a1825c90507f9852f8e8d49fd9a2e49e060d8d3b08d73a4cad92444150877509d7ab57f2e5ef83826040516100e2929190610226565b60405180910390a1505050565b5f825c90507f9852f8e8d49fd9a2e49e060d8d3b08d73a4cad92444150877509d7ab57f2e5ef8382604051610125929190610226565b60405180910390a1818103610165577fd48fe2800bace8f5ca2450feacbd6efc681b1cd0115019bb49fa529b6171bf6760405160405180910390a161019d565b7fc9e730d5b570f89e168eb8c3d29f8c396b957e540af248c95c9519ac47c2c69f8160405161019491906102cd565b60405180910390a15b505050565b5f5ffd5b5f819050919050565b6101b8816101a6565b81146101c2575f5ffd5b50565b5f813590506101d3816101af565b92915050565b5f5f604083850312156101ef576101ee6101a2565b5b5f6101fc858286016101c5565b925050602061020d858286016101c5565b9150509250929050565b610220816101a6565b82525050565b5f6040820190506102395f830185610217565b6102466020830184610217565b9392505050565b5f82825260208201905092915050565b7f56616c7565206c6f6164656420697320646966666572656e742066726f6d20745f8201527f6865206578706563746564000000000000000000000000000000000000000000602082015250565b5f6102b7602b8361024d565b91506102c28261025d565b604082019050919050565b5f6040820190508181035f8301526102e4816102ab565b90506102f36020830184610217565b9291505056fea2646970667358221220433294a89265547198272c5831a9646c55777d997ff5f31e3d70a38fb431c2ea64736f6c634300081c0033
    gas 1000000
    build

# Create block to hold txTloadTstoreCheckingBetweenTransactionsContract transaction
block_build b01
    parent g00
    transactions txTloadTstoreCheckingBetweenTransactionsContract
    build

# Connect block
block_connect b01

# Check b01 is best block
assert_best b01

# Create transaction to execute
transaction_build txTstoreAndTloadSomeValue
    sender acc1
    nonce 1
    contract txTloadTstoreCheckingBetweenTransactionsContract
    value 0
    data 98c051f400000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000000000000000000000000000000000000000000064
    gas 200000
    build

# Create transaction to execute
transaction_build txTloadSomeValueAndCheckWithExpected
    sender acc1
    nonce 2
    contract txTloadTstoreCheckingBetweenTransactionsContract
    value 0
    data a042e69500000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000000000000000000000000000000000000000000000
    gas 200000
    build

# Create block to hold txTloadSomeValueAndCheckWithExpected transaction
block_build b02
    parent b01
    transactions txTstoreAndTloadSomeValue txTloadSomeValueAndCheckWithExpected
    gasLimit 500000
    build

# Connect block
block_connect b02

# Check b02 is best block
assert_best b02
